An $O(n^2)$ algorithm for 